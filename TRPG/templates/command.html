<!-- command.html -->
{% extends "base.html" %}
{% block title %}コマンド実行{% endblock %}
{% block content %}
<h1>コマンド実行</h1>
<form id="commandForm" method="POST" action="/command">
    <label for="command_input">コマンドを入力:</label><br>
    <input type="text" id="command_input" name="command_input"><br><br>
    <button type="submit">実行</button>
</form>

<hr>

<!-- コマンドのログ出力エリア -->
<div id="commandOutput">
    {% if command_logs %}
        {% for log in command_logs %}
            <p>{{ log }}</p>
        {% endfor %}
    {% endif %}
</div>

<script>
    // コマンド実行フォームのサブミットを監視
    document.getElementById('commandForm').addEventListener('submit', function(event) {
        event.preventDefault();  // デフォルトのフォーム送信を防止
        
        // フォームデータを取得
        var formData = new FormData(this);
        
        // AJAXリクエストを送信
        fetch('/command', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(data => {
            // 受け取ったデータ（コマンドログ）をログ出力エリアに追加
            var commandOutput = document.getElementById('commandOutput');
            var newLog = document.createElement('p');
            newLog.textContent = data;
            commandOutput.appendChild(newLog);
            
            // 入力フィールドをクリア
            document.getElementById('command_input').value = '';
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>

{% endblock %}
